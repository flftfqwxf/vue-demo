var gift={
          '1':{'title':"昆仑山雪山矿泉水无门槛抵用券",
               'desc':"在“昆仑山微店”购买全场任意产品均可抵扣40元现金。兑换码及详细规则将在2个工作日内发至下单时填写的联系人手机号码。",
               'logo':"1.png",'price':40,'rules':1},
          '2':{'title':"奇迹健身免费体验卡",
               'desc':"可在奇迹健身SM广场店免费健身体验一次。该礼品为实物卡，下单后2个工作日内客服人员将与您联系确认邮寄地址。",
               'logo':"2.png",'price':128,'rules':0},
          '3':{'title':"阿帕鲁萨小镇餐吧无门槛抵用券",
               'desc':"可消费任意食品/酒水时使用。兑换码及详细规则将在2个工作日内发至下单时填写的联系人手机号码。",
               'logo':"3.png",'price':30,'rules':2},
          '4':{'title':"红光国际马术俱乐部免费体验券",
               'desc':"可享受30分钟马术体验一次。兑换码及详细规则将在2个工作日内发至下单时填写的联系人手机号码。",
               'logo':"4.png",'price':100,'rules':3},
          '5':{'title':"轻安雅集瑜伽免费体验券",
               'desc':"可享受瑜伽体验一次（身体评估、肩颈梳理、定制练习方案）。兑换码及详细规则将在2个工作日内发至下单时填写的联系人手机号码。",
               'logo':"5.png",'price':398,'rules':4}
          };
var proGift={'5428':[1,3],
            '8412':[1,2],
            '2440':[2,3],
            '17105':[2,3],
            '17099':[2,3],
            '17080':[1,5,3]
             };


//设置产品的相应礼包            
function setGift(){
  $(".module .module_item").each(function(index, el) {
    var proId= $(this).attr("pro-id");
    var html="",price=0;
    if(proGift[proId] != null){
      for (var i = 0; i < proGift[proId].length; i++) {
        var giftId=proGift[proId][i];
        price+=gift[giftId].price;
      }
      $(this).find(".gift_info").html('<small class="gift_icon"></small>价值'+price+'元大礼包<span class="gift_view J_info">礼包详情</span>');    
      $(this).find(".J_info").click(function(){
      var giftData={'allPrice':0,'gifts':[]};
        for (var i = 0; i < proGift[proId].length; i++) {
          var giftId=proGift[proId][i];
          giftData.gifts.push(gift[giftId]);
        }
        giftData.allPrice=price;
        $(".gift_detail").remove();
        $(".mask").removeClass("hidden");
        $("body,html").css({"overflow":"hidden"});     
        $("body").append(template("gift_detail", giftData));
        var h=$(window).height()-110;
        $(".gift_detail .gift").css({"max-height":h+"px"});
      });
    }
  });

}
//判断是否是微信端
function isWeiXin(){
    var ua = window.navigator.userAgent.toLowerCase();
    if(ua.match(/MicroMessenger/i) == 'micromessenger'){
        return true;
    }else{
        return false;
    }
}


//领取奖品
function getGift(){
    var regex= /^0?(13[0-9]|15[0-9]|17[01678]|18[0-9]|14[57])[0-9]{8}$/;
    var phone=$(".input_phone").val(),
    $obj=$("#share_success"),
    get_success=false;
    if(!regex.test(phone)){
      $obj.find(".erro").text("请输入合法的手机号！");
    }else{
      $obj.find(".erro").text("");
     /* $.ajax({
           url: '',
           type: 'POST',
           dataType: 'json',
           data: {phone: phone},
         })
         .done(function() {
            get_success=true;
            $("#share_success").hide(100);
            $("#get_success").removeClass('hidden').show(300);
         })
         .fail(function() {
            $obj.find(".erro").text("error");
         });    */
    }
    if(get_success){
      $obj.find(".share_success").addClass('hidden');
      $obj.find(".get_success").removeClass('hidden');
    }
}

document.body.addEventListener('touchmove', function (event) {
    if($(".gift_detail").is(":visible")){
      event.preventDefault();
    }else{

    }
}, false);  
(function(){
    //为产品设置礼包
    setGift();

    //关闭礼包详情
   $('body').on("click",".J_close",function(){
      $(".gift_detail").remove();
      $(".mask").addClass("hidden");
        $("body,html").css({"overflow-y":"auto"});
    });

   //点击见面礼的礼包详情
   $(".J_meet").click(function(){
      var giftData={'allPrice':gift['2'].price,'gifts':[gift['2']]};
      $(".gift_detail").remove();
      $(".mask").removeClass("hidden");
      $("body,html").css({"overflow":"hidden"});
      $("body").append(template("gift_detail", giftData));
      var h=$(window).height()-110;
      $(".gift_detail .gift").css({"max-height":h+"px"});
   });

   //点击领取见面礼
   $("header").on("click",".J_giftBtn",function(){
      if(isWeiXin()){
          checkSuccess=true;
          $(".share_tips").removeClass("hidden").show();
          $(".returnTop").hide();
      }else{
          alert('在微信中访问本页面才能抽奖哦！');
      }
   });

   //输入电话号码领取奖品
   $("#weiXinSuccess").on("click",".J_getGift",function(){
        getGift();
   });

  $("#weiXinSuccess").on('click', '.J_goPro', function(event) {
    
  });
  //点击微信提示，微信提示消失       
   $(".share_tips").click(function() {
     $(this).hide();
   });

 })();